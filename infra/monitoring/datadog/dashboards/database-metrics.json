{
  "title": "PULL Database & Cache - Performance Dashboard",
  "description": "Database (Convex, PostgreSQL), Redis cache, and data store metrics",
  "widgets": [
    {
      "id": 1,
      "definition": {
        "title": "Convex - Query Latency (ms)",
        "type": "timeseries",
        "requests": [
          {
            "formulas": [
              {"formula": "a", "alias": "p50"},
              {"formula": "b", "alias": "p95"},
              {"formula": "c", "alias": "p99"}
            ],
            "queries": [
              {
                "name": "a",
                "data_source": "metrics",
                "query": "avg:pull.convex.query.latency.p50{service:pull-api}"
              },
              {
                "name": "b",
                "data_source": "metrics",
                "query": "avg:pull.convex.query.latency.p95{service:pull-api}"
              },
              {
                "name": "c",
                "data_source": "metrics",
                "query": "avg:pull.convex.query.latency.p99{service:pull-api}"
              }
            ],
            "response_format": "timeseries",
            "style": {
              "palette": "cool"
            },
            "display_type": "line"
          }
        ],
        "yaxis": {
          "include_zero": true,
          "label": "ms"
        }
      },
      "layout": {
        "x": 0,
        "y": 0,
        "width": 6,
        "height": 3
      }
    },
    {
      "id": 2,
      "definition": {
        "title": "Convex - Mutation Latency (ms)",
        "type": "timeseries",
        "requests": [
          {
            "formulas": [
              {"formula": "a", "alias": "p50"},
              {"formula": "b", "alias": "p95"},
              {"formula": "c", "alias": "p99"}
            ],
            "queries": [
              {
                "name": "a",
                "data_source": "metrics",
                "query": "avg:pull.convex.mutation.latency.p50{service:pull-api}"
              },
              {
                "name": "b",
                "data_source": "metrics",
                "query": "avg:pull.convex.mutation.latency.p95{service:pull-api}"
              },
              {
                "name": "c",
                "data_source": "metrics",
                "query": "avg:pull.convex.mutation.latency.p99{service:pull-api}"
              }
            ],
            "response_format": "timeseries",
            "style": {
              "palette": "warm"
            },
            "display_type": "line"
          }
        ],
        "yaxis": {
          "include_zero": true,
          "label": "ms"
        }
      },
      "layout": {
        "x": 6,
        "y": 0,
        "width": 6,
        "height": 3
      }
    },
    {
      "id": 3,
      "definition": {
        "title": "Convex - Operations/sec",
        "type": "timeseries",
        "requests": [
          {
            "formulas": [
              {"formula": "per_second(a)", "alias": "Queries"},
              {"formula": "per_second(b)", "alias": "Mutations"}
            ],
            "queries": [
              {
                "name": "a",
                "data_source": "metrics",
                "query": "sum:pull.convex.query.count{service:pull-api}.as_count()"
              },
              {
                "name": "b",
                "data_source": "metrics",
                "query": "sum:pull.convex.mutation.count{service:pull-api}.as_count()"
              }
            ],
            "response_format": "timeseries",
            "style": {
              "palette": "dog_classic"
            },
            "display_type": "line"
          }
        ]
      },
      "layout": {
        "x": 0,
        "y": 3,
        "width": 6,
        "height": 3
      }
    },
    {
      "id": 4,
      "definition": {
        "title": "Convex - Error Rate",
        "type": "timeseries",
        "requests": [
          {
            "formulas": [
              {"formula": "(a / (a + b)) * 100"}
            ],
            "queries": [
              {
                "name": "a",
                "data_source": "metrics",
                "query": "sum:pull.convex.errors{service:pull-api}.as_count()"
              },
              {
                "name": "b",
                "data_source": "metrics",
                "query": "sum:pull.convex.success{service:pull-api}.as_count()"
              }
            ],
            "response_format": "timeseries",
            "style": {
              "palette": "red"
            },
            "display_type": "line"
          }
        ],
        "yaxis": {
          "include_zero": true,
          "label": "%"
        }
      },
      "layout": {
        "x": 6,
        "y": 3,
        "width": 6,
        "height": 3
      }
    },
    {
      "id": 5,
      "definition": {
        "type": "note",
        "content": "## Redis Cache Metrics",
        "background_color": "gray",
        "font_size": "18",
        "text_align": "center",
        "vertical_align": "center",
        "show_tick": false,
        "tick_pos": "50%",
        "tick_edge": "left"
      },
      "layout": {
        "x": 0,
        "y": 6,
        "width": 12,
        "height": 1
      }
    },
    {
      "id": 6,
      "definition": {
        "title": "Redis - Cache Hit Rate",
        "type": "query_value",
        "requests": [
          {
            "formulas": [
              {
                "formula": "(a / (a + b)) * 100"
              }
            ],
            "queries": [
              {
                "name": "a",
                "data_source": "metrics",
                "query": "sum:pull.redis.hits{service:pull-api}.as_count()"
              },
              {
                "name": "b",
                "data_source": "metrics",
                "query": "sum:pull.redis.misses{service:pull-api}.as_count()"
              }
            ],
            "response_format": "scalar"
          }
        ],
        "precision": 1,
        "custom_unit": "%",
        "text_align": "center",
        "conditional_formats": [
          {
            "comparator": ">=",
            "value": 90,
            "palette": "white_on_green"
          },
          {
            "comparator": ">=",
            "value": 70,
            "palette": "white_on_yellow"
          },
          {
            "comparator": "<",
            "value": 70,
            "palette": "white_on_red"
          }
        ]
      },
      "layout": {
        "x": 0,
        "y": 7,
        "width": 2,
        "height": 2
      }
    },
    {
      "id": 7,
      "definition": {
        "title": "Redis - Memory Used",
        "type": "query_value",
        "requests": [
          {
            "formulas": [
              {
                "formula": "a / 1073741824"
              }
            ],
            "queries": [
              {
                "name": "a",
                "data_source": "metrics",
                "query": "avg:redis.mem.used{service:pull-redis}"
              }
            ],
            "response_format": "scalar"
          }
        ],
        "precision": 2,
        "custom_unit": "GB",
        "text_align": "center"
      },
      "layout": {
        "x": 2,
        "y": 7,
        "width": 2,
        "height": 2
      }
    },
    {
      "id": 8,
      "definition": {
        "title": "Redis - Connected Clients",
        "type": "query_value",
        "requests": [
          {
            "formulas": [
              {
                "formula": "a"
              }
            ],
            "queries": [
              {
                "name": "a",
                "data_source": "metrics",
                "query": "avg:redis.net.clients{service:pull-redis}"
              }
            ],
            "response_format": "scalar"
          }
        ],
        "precision": 0,
        "text_align": "center"
      },
      "layout": {
        "x": 4,
        "y": 7,
        "width": 2,
        "height": 2
      }
    },
    {
      "id": 9,
      "definition": {
        "title": "Redis - Commands/sec",
        "type": "timeseries",
        "requests": [
          {
            "formulas": [
              {"formula": "per_second(a)", "alias": "GET"},
              {"formula": "per_second(b)", "alias": "SET"},
              {"formula": "per_second(c)", "alias": "DEL"}
            ],
            "queries": [
              {
                "name": "a",
                "data_source": "metrics",
                "query": "sum:pull.redis.commands.get{service:pull-api}.as_count()"
              },
              {
                "name": "b",
                "data_source": "metrics",
                "query": "sum:pull.redis.commands.set{service:pull-api}.as_count()"
              },
              {
                "name": "c",
                "data_source": "metrics",
                "query": "sum:pull.redis.commands.del{service:pull-api}.as_count()"
              }
            ],
            "response_format": "timeseries",
            "style": {
              "palette": "cool"
            },
            "display_type": "line"
          }
        ]
      },
      "layout": {
        "x": 6,
        "y": 7,
        "width": 6,
        "height": 3
      }
    },
    {
      "id": 10,
      "definition": {
        "title": "Redis - Latency (ms)",
        "type": "timeseries",
        "requests": [
          {
            "formulas": [
              {"formula": "a", "alias": "p50"},
              {"formula": "b", "alias": "p95"},
              {"formula": "c", "alias": "p99"}
            ],
            "queries": [
              {
                "name": "a",
                "data_source": "metrics",
                "query": "avg:pull.redis.latency.p50{service:pull-api}"
              },
              {
                "name": "b",
                "data_source": "metrics",
                "query": "avg:pull.redis.latency.p95{service:pull-api}"
              },
              {
                "name": "c",
                "data_source": "metrics",
                "query": "avg:pull.redis.latency.p99{service:pull-api}"
              }
            ],
            "response_format": "timeseries",
            "style": {
              "palette": "warm"
            },
            "display_type": "line"
          }
        ],
        "yaxis": {
          "include_zero": true,
          "label": "ms"
        }
      },
      "layout": {
        "x": 0,
        "y": 10,
        "width": 6,
        "height": 3
      }
    },
    {
      "id": 11,
      "definition": {
        "title": "Redis - Keys by Pattern",
        "type": "toplist",
        "requests": [
          {
            "formulas": [
              {
                "formula": "a",
                "limit": {
                  "count": 10,
                  "order": "desc"
                }
              }
            ],
            "queries": [
              {
                "name": "a",
                "data_source": "metrics",
                "query": "sum:pull.redis.keys.count{service:pull-api} by {pattern}"
              }
            ],
            "response_format": "scalar"
          }
        ]
      },
      "layout": {
        "x": 6,
        "y": 10,
        "width": 6,
        "height": 3
      }
    },
    {
      "id": 12,
      "definition": {
        "type": "note",
        "content": "## PostgreSQL Metrics",
        "background_color": "gray",
        "font_size": "18",
        "text_align": "center",
        "vertical_align": "center",
        "show_tick": false,
        "tick_pos": "50%",
        "tick_edge": "left"
      },
      "layout": {
        "x": 0,
        "y": 13,
        "width": 12,
        "height": 1
      }
    },
    {
      "id": 13,
      "definition": {
        "title": "PostgreSQL - Active Connections",
        "type": "timeseries",
        "requests": [
          {
            "formulas": [
              {"formula": "a", "alias": "Active"},
              {"formula": "b", "alias": "Idle"},
              {"formula": "c", "alias": "Max"}
            ],
            "queries": [
              {
                "name": "a",
                "data_source": "metrics",
                "query": "avg:postgresql.connections.active{service:pull-postgres}"
              },
              {
                "name": "b",
                "data_source": "metrics",
                "query": "avg:postgresql.connections.idle{service:pull-postgres}"
              },
              {
                "name": "c",
                "data_source": "metrics",
                "query": "avg:postgresql.connections.max{service:pull-postgres}"
              }
            ],
            "response_format": "timeseries",
            "style": {
              "palette": "dog_classic"
            },
            "display_type": "line"
          }
        ]
      },
      "layout": {
        "x": 0,
        "y": 14,
        "width": 6,
        "height": 3
      }
    },
    {
      "id": 14,
      "definition": {
        "title": "PostgreSQL - Query Performance",
        "type": "timeseries",
        "requests": [
          {
            "formulas": [
              {"formula": "a", "alias": "Query p95"},
              {"formula": "b", "alias": "Transaction p95"}
            ],
            "queries": [
              {
                "name": "a",
                "data_source": "metrics",
                "query": "avg:postgresql.query.latency.p95{service:pull-postgres}"
              },
              {
                "name": "b",
                "data_source": "metrics",
                "query": "avg:postgresql.transaction.latency.p95{service:pull-postgres}"
              }
            ],
            "response_format": "timeseries",
            "style": {
              "palette": "warm"
            },
            "display_type": "line"
          }
        ],
        "yaxis": {
          "include_zero": true,
          "label": "ms"
        }
      },
      "layout": {
        "x": 6,
        "y": 14,
        "width": 6,
        "height": 3
      }
    },
    {
      "id": 15,
      "definition": {
        "title": "PostgreSQL - Rows Read/Written",
        "type": "timeseries",
        "requests": [
          {
            "formulas": [
              {"formula": "per_second(a)", "alias": "Rows Read"},
              {"formula": "per_second(b)", "alias": "Rows Inserted"},
              {"formula": "per_second(c)", "alias": "Rows Updated"},
              {"formula": "per_second(d)", "alias": "Rows Deleted"}
            ],
            "queries": [
              {
                "name": "a",
                "data_source": "metrics",
                "query": "sum:postgresql.rows.read{service:pull-postgres}.as_count()"
              },
              {
                "name": "b",
                "data_source": "metrics",
                "query": "sum:postgresql.rows.inserted{service:pull-postgres}.as_count()"
              },
              {
                "name": "c",
                "data_source": "metrics",
                "query": "sum:postgresql.rows.updated{service:pull-postgres}.as_count()"
              },
              {
                "name": "d",
                "data_source": "metrics",
                "query": "sum:postgresql.rows.deleted{service:pull-postgres}.as_count()"
              }
            ],
            "response_format": "timeseries",
            "style": {
              "palette": "semantic"
            },
            "display_type": "bars"
          }
        ]
      },
      "layout": {
        "x": 0,
        "y": 17,
        "width": 6,
        "height": 3
      }
    },
    {
      "id": 16,
      "definition": {
        "title": "PostgreSQL - Disk Usage",
        "type": "timeseries",
        "requests": [
          {
            "formulas": [
              {"formula": "a / 1073741824", "alias": "Database Size"},
              {"formula": "b / 1073741824", "alias": "Table Size"},
              {"formula": "c / 1073741824", "alias": "Index Size"}
            ],
            "queries": [
              {
                "name": "a",
                "data_source": "metrics",
                "query": "avg:postgresql.database_size{service:pull-postgres}"
              },
              {
                "name": "b",
                "data_source": "metrics",
                "query": "avg:postgresql.table_size{service:pull-postgres}"
              },
              {
                "name": "c",
                "data_source": "metrics",
                "query": "avg:postgresql.index_size{service:pull-postgres}"
              }
            ],
            "response_format": "timeseries",
            "style": {
              "palette": "purple"
            },
            "display_type": "line"
          }
        ],
        "yaxis": {
          "include_zero": true,
          "label": "GB"
        }
      },
      "layout": {
        "x": 6,
        "y": 17,
        "width": 6,
        "height": 3
      }
    },
    {
      "id": 17,
      "definition": {
        "title": "Slowest Queries",
        "type": "toplist",
        "requests": [
          {
            "formulas": [
              {
                "formula": "a",
                "limit": {
                  "count": 10,
                  "order": "desc"
                }
              }
            ],
            "queries": [
              {
                "name": "a",
                "data_source": "metrics",
                "query": "avg:pull.db.query.duration{service:pull-api} by {query_hash}"
              }
            ],
            "response_format": "scalar"
          }
        ]
      },
      "layout": {
        "x": 0,
        "y": 20,
        "width": 6,
        "height": 3
      }
    },
    {
      "id": 18,
      "definition": {
        "title": "Query Volume by Table",
        "type": "toplist",
        "requests": [
          {
            "formulas": [
              {
                "formula": "a",
                "limit": {
                  "count": 15,
                  "order": "desc"
                }
              }
            ],
            "queries": [
              {
                "name": "a",
                "data_source": "metrics",
                "query": "sum:pull.db.query.count{service:pull-api} by {table}.as_count()"
              }
            ],
            "response_format": "scalar"
          }
        ]
      },
      "layout": {
        "x": 6,
        "y": 20,
        "width": 6,
        "height": 3
      }
    }
  ],
  "template_variables": [
    {
      "name": "env",
      "default": "production",
      "prefix": "env",
      "available_values": ["production", "staging", "development"]
    }
  ],
  "layout_type": "ordered",
  "notify_list": [],
  "reflow_type": "fixed"
}
